<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="utf-8" />
    <title>Ganpoom Tracker Test</title>
    <meta
      name="description"
      content="배포된 ganpoom-tracker.js가 클릭/견적요청을 정상적으로 기록하는지 확인하는 테스트 페이지입니다."
    />
    <style>
      body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
        background: #f4f6fb;
        margin: 0;
        padding: 40px 20px;
      }
      .container {
        max-width: 520px;
        margin: 0 auto;
        background: #fff;
        border-radius: 16px;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.08);
        padding: 32px;
      }
      h1 {
        margin-top: 0;
        margin-bottom: 12px;
        font-size: 1.8rem;
        color: #111;
      }
      p {
        margin: 0 0 16px;
        line-height: 1.6;
        color: #555;
      }
      .note {
        background: #eef5ff;
        border: 1px solid #c9defc;
        border-radius: 12px;
        padding: 16px;
        margin-bottom: 24px;
        font-size: 0.95rem;
      }
      input,
      textarea,
      button {
        font-size: 1rem;
        width: 100%;
        margin-bottom: 14px;
        border-radius: 10px;
        border: 1px solid #cfd8e3;
        padding: 12px 14px;
        box-sizing: border-box;
      }
      textarea {
        min-height: 120px;
        resize: vertical;
      }
      button {
        background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        color: white;
        font-weight: 600;
        border: none;
        cursor: pointer;
        transition: opacity 0.2s ease;
      }
      button:hover {
        opacity: 0.9;
      }
      .status {
        margin-top: 16px;
        font-size: 0.95rem;
        color: #333;
        word-break: break-all;
      }
      code {
        background: #f1f3f8;
        padding: 2px 6px;
        border-radius: 6px;
        font-size: 0.9rem;
      }
    </style>

    <!-- 배포된 트래커 스크립트 사용 -->
    <script
      src="https://ganpoom-tracker-htkz.vercel.app/ganpoom-tracker.js"
      data-api-endpoint="https://ganpoom-tracker-htkz.vercel.app/api"
      defer
    ></script>
  </head>
  <body>
    <div class="container">
      <h1>에이전트 트래커 테스트</h1>
      <p>
        이 페이지는 <code>ganpoom-tracker.js</code>가 배포 환경에서 정상적으로 작동하는지
        확인하기 위한 임시 테스트 페이지입니다.
      </p>

      <div class="note">
        <strong>사용 방법</strong>
        <ol>
          <li>
            주소 끝에 <code>?ref=에이전트ID</code>를 붙여 접속하세요.<br />
            예: <code>https://ganpoom-tracker-htkz.vercel.app/agent-tracker-test.html?ref=NXdz9u</code>
          </li>
          <li>
            개발자 도구(Network 탭)에서 <code>/api/track/click</code>,
            <code>/api/track/conversion</code> 요청을 확인하세요.
          </li>
          <li>Supabase의 <code>link_clicks</code>, <code>quote_requests</code> 테이블에 데이터가 추가되는지 확인하세요.</li>
        </ol>
      </div>

      <form id="quote-form">
        <input type="text" name="title" placeholder="고객명 또는 회사명" required />
        <input type="tel" name="phone" placeholder="전화번호" required />
        <textarea name="comments" placeholder="요청사항을 입력하세요"></textarea>
        <button type="submit">견적요청 보내기</button>
      </form>

      <div class="status" id="statusLog">
        상태 메시지가 여기에 표시됩니다. (개발자 도구 콘솔 로그도 함께 확인하세요)
      </div>
    </div>

    <script>
      ;(function () {
        const statusLog = document.getElementById('statusLog')
        const quoteForm = document.getElementById('quote-form')

        function log(message, data) {
          const time = new Date().toLocaleTimeString()
          statusLog.innerText = `[${time}] ${message}${
            data ? ' → ' + JSON.stringify(data, null, 2) : ''
          }`
          console.log('[TEST]', message, data || '')
        }

        window.addEventListener('DOMContentLoaded', () => {
          if (window.GanpoomTracker) {
            log('GanpoomTracker 로드 완료. URL의 ref 파라미터를 확인하세요.')
          } else {
            log('GanpoomTracker 로드 실패. 스크립트 경로나 네트워크 상태를 확인하세요.')
          }
        })

        quoteForm.addEventListener('submit', (e) => {
          e.preventDefault()
          log('폼 제출 감지. tracking API 요청을 확인하세요. (페이지 이동 차단됨)')

          setTimeout(() => {
            quoteForm.reset()
          }, 500)
        })
      })()
    </script>
  </body>
</html>

